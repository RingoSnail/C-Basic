【概述】

互联网，ISP互联网服务提供商，
C/S模式，P2P模式
电路交换，分组交换
总时延=排队时延+处理时延+传输时延+传播时延

五层协议：
应用层：HTTP,DNS
传输层：TCP,UDP
网络层：分组 IP
链路层：帧
物理层：比特流

OSI:
表示层：数据压缩加密，数据描述
会话层：建立及管理会话

【物理层】

双工
调制

【链路层】

CRC循环冗余校验进行差错控制
透明传输：转义字符会被无视，转义字符是为了防止数据内容和首尾界定相同而出错

点对点通信：

PPP协议：用户和ISP点对点通信的协议

广播通信：

信道复用：频分，时分，统计时分，波分（光通信），码分（每个用户分配长度为m的码片，全部正交，但数据量翻为m倍）

CSMA/CD协议：载波监听多点接入/碰撞检测
检测到碰撞时要等待 采用截断二进制指数退避算法

MAC地址：6字节，网卡地址

局域网LAN是一种典型的广播信道，主要是以太网
局域网内使用集线器，交换机进行存储转发

虚拟局域网VLAN，加了4字节首部以标识虚拟局域网

【网络层】

网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。

IP,ARP,ICMP,IGMP

IP:
数据报格式，

地址格式：A，B，C，子网，
？？？无分类CIDR：前缀号主机号/前缀位数 减少了路由表项

ARP：地址解析协议
IP→ARP→MAC

ICMP:网际控制报文
封装在IP数据报里，内容是差错报告报文和询问报文
应用是ping和traceroute（跟踪路径）

VPN：隧道技术

NAT：网络地址转换
NAPT：网络地址端口转换

路由器：

路由选择：
自治系统内部：
RIP：基于距离向量，通过交换相邻路由表实现，实现简单，开销小，但网络规模受限
OSPF：开放最短路径优先。最短路径优先表示使用了 Dijkstra 提出的最短路径算法 SPF
通过洪泛发送相邻的路由信息，只有链路状态改变时才发。最终所有路由器都有全网的拓扑结构图
自治系统间的：
BGP：边界网关协议。每个AS都要BGP发言人，之间通过TCP连接来交换路由信息

分组转发：
能直接交付的直接交付，明确知道下一跳的就传，不能的都传给默认路由器

【传输层】

是进程之间的逻辑通信

UDP：无连接的，尽可能交付，没有拥塞控制，面向报文，支持多对多

TCP：面向连接的，提供可靠交付，有流量控制，拥塞控制，面向字节流，只能一对一

首部多了序号、确认号、数据偏移、确认ACK（同步后直接置1）、同步SYN（连接建立时同步序号）、终止FIN、窗口（是因为对方缓存可能是有限的）

TCP三次握手：（建立）
第一次：客户端→服务端：请求报文SYN=1,ACK=0,x（客户端序号）
第二次：客户端←服务端：确认报文SYN=1,ACK=1,x+1,y（服务端序号）
第三次：客户端→服务端：确认报文      ACK=1,x+1,y+1

第三次握手是为了防止滞留的失效链接到达服务器，自动忽略其他链接

TCP四次握手：（终止）
第一次：客户端→服务端：释放报文FIN=1（ACK=1,序号同上）
第二次：客户端←服务端：确认报文
第三次：客户端←服务端：释放报文FIN=1
第三次：客户端→服务端：确认报文，进入TIME-WAIT状态（防止最后这个确认报文没传到，也是等所有报文在网络中全部消失）

四次握手多了一次先传完的确认报文

TCP可靠传输：
超时时间RTO=RTTs（加权平均往返时间）+4RTTd（加权平均偏差值）

TCP滑动窗口：
窗口是缓存的一部分，用来存放字节流

TCP流量控制：
通过窗口大小控制发送速率

TCP拥塞控制：
控制整个网络的拥塞程度，保证一定的吞吐量
慢开始，拥塞避免（拥塞窗口cwnd加倍增长，直至到达门限ssthresh，cwnd每次增加1，如果超时，则ssthresh=cwnd/2）
快重传，快恢复（报文段丢失了就快重传，然后直接快恢复：cwnd=ssthresh，直接进入拥塞避免）

【应用层】

DNS：是一个分布式数据库，提供域名与IP地址的转换
通过UDP，
TCP传输：响应超过512字节，区域传送

FTP：文件传送协议
使用两个TCP连接，一个控制连接，一个数据连接
主动模式和被动模式是对服务端而言的，谁主动谁发数据，谁被动谁开放端口号

DHCP：动态主机配置协议
DHCP服务器给接入的客户端配置IP，子网掩码，网关IP

TELNET：远程登陆协议

邮件协议：发送SMTP，读取POP3，IMAP

WEB页面请求过程：
DHCP配置主机信息（子网内给主机配置）；ARP解析MAC地址（查网关路由器的MAC地址）；
DNS解析域名（解析出服务器IP地址）；HTTP请求页面（HTTP GET， TCP连接）
